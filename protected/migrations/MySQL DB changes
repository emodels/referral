/*---( Pending migrations )---*/
ALTER TABLE `entry` ADD `date_of_birth` DATE NULL ;
ALTER TABLE `entry` ADD `additional_email` VARCHAR(50) NULL AFTER `email`;
ALTER TABLE `entry` ADD `property_holder` VARCHAR(20) NOT NULL ;
ALTER TABLE `entry` ADD `client_portal_status` TINYINT NOT NULL ;

ALTER TABLE `user` ADD `entry` INT NOT NULL ;

CREATE TABLE IF NOT EXISTS `document_category` (
`id` int(11) NOT NULL,
  `name` VARCHAR(200) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

ALTER TABLE `document_category`
 ADD PRIMARY KEY (`id`);

ALTER TABLE `document_category`
MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

CREATE TABLE IF NOT EXISTS `property` (
  `id` int(11) NOT NULL,
  `entry` int(11) NOT NULL,
  `builder` varchar(200) NOT NULL,
  `address` varchar(500) NOT NULL,
  `status` varchar(50) NOT NULL,
  `owner` int(11) NOT NULL,
  `initial_deposit` tinyint(4) NOT NULL,
  `contracts_signed` tinyint(4) NOT NULL,
  `five_ten_deposit` tinyint(4) NOT NULL,
  `firb_approval` tinyint(4) NOT NULL,
  `finance_approval` tinyint(4) NOT NULL,
  `property_completion` tinyint(4) NOT NULL,
  `rented_out` tinyint(4) NOT NULL,
  `insurance_in_place` tinyint(4) NOT NULL,
  `first_created_date` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `last_update_date` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

ALTER TABLE `property`
ADD PRIMARY KEY (`id`), ADD KEY `owner` (`owner`), ADD KEY `entry` (`entry`);

ALTER TABLE `property`
MODIFY `id` int(11) NOT NULL AUTO_INCREMENT,AUTO_INCREMENT=1;

ALTER TABLE `property`
ADD CONSTRAINT `property_ibfk_1` FOREIGN KEY (`entry`) REFERENCES `entry` (`id`) ON DELETE CASCADE,
ADD CONSTRAINT `property_ibfk_2` FOREIGN KEY (`owner`) REFERENCES `user` (`id`) ON DELETE CASCADE;

CREATE TABLE IF NOT EXISTS `entry_document_category` (
  `id` int(11) NOT NULL,
  `entry` int(11) NOT NULL,
  `category` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

ALTER TABLE `entry_document_category`
ADD PRIMARY KEY (`id`), ADD KEY `entry` (`entry`,`category`);

ALTER TABLE `entry_document_category`
MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

ALTER TABLE `entry_document_category`
ADD CONSTRAINT `entry_document_category_ibfk_1` FOREIGN KEY (`entry`) REFERENCES `entry` (`id`) ON DELETE CASCADE,
ADD CONSTRAINT `entry_document_category_ibfk_2` FOREIGN KEY (`category`) REFERENCES `document_category` (`id`) ON DELETE CASCADE;

CREATE TABLE IF NOT EXISTS `property_document` (
  `id` int(11) NOT NULL,
  `property` int(11) NOT NULL,
  `category` int(11) NOT NULL,
  `caption` varchar(200) NOT NULL,
  `document` text NOT NULL,
  `entry_date` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

ALTER TABLE `property_document`
ADD PRIMARY KEY (`id`), ADD KEY `property` (`property`,`category`), ADD KEY `category` (`category`);

ALTER TABLE `property_document`
MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

ALTER TABLE `property_document`
ADD CONSTRAINT `property_document_ibfk_1` FOREIGN KEY (`property`) REFERENCES `property` (`id`) ON DELETE CASCADE,
ADD CONSTRAINT `property_document_ibfk_2` FOREIGN KEY (`category`) REFERENCES `document_category` (`id`) ON DELETE CASCADE;

ALTER TABLE `user` ADD `allow_portal_management` INT NOT NULL ;
ALTER TABLE `user` ADD `logo` longblob NULL;
ALTER TABLE `user` ADD `header_title` TEXT NULL;

CREATE TABLE IF NOT EXISTS `receipt` (
  `id` int(11) NOT NULL,
  `receipt_number` int(11) NOT NULL,
  `company_logo` longblob NOT NULL,
  `company_name` varchar(100) NOT NULL,
  `company_address` varchar(500) NOT NULL,
  `partner_name` varchar(100) NOT NULL,
  `partner_telephone` varchar(50) NOT NULL,
  `partner_email` varchar(50) NOT NULL,
  `landlord_name` varchar(100) NOT NULL,
  `property_id` int(11) NOT NULL,
  `property_address` varchar(500) NOT NULL,
  `tenant_name` varchar(100) NOT NULL,
  `rent` double(10,2) NOT NULL,
  `paid` double(10,2) NOT NULL,
  `from_date` date NOT NULL,
  `to_date` date NOT NULL,
  `management_fees` double(10,2) NOT NULL,
  `gst` double(10,2) NOT NULL,
  `receipt_date` date NOT NULL,
  `signature` longblob NOT NULL,
  `status` int(11) NOT NULL,
  `pdf` longblob
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;

ALTER TABLE `receipt`
ADD PRIMARY KEY (`id`), ADD KEY `property_id` (`property_id`);

ALTER TABLE `receipt`
MODIFY `id` int(11) NOT NULL AUTO_INCREMENT,AUTO_INCREMENT=6;

ALTER TABLE `receipt`
ADD CONSTRAINT `receipt_ibfk_1` FOREIGN KEY (`property_id`) REFERENCES `property` (`id`) ON DELETE CASCADE;